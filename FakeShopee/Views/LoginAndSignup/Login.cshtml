@{
    ViewData["Title"] = "Đăng Nhập";
    Layout = "_LoginAndSignupLayout";
}
@model Users

<head>
    <link href="~/css/LoginAndSignup.css" rel="stylesheet" type="text/css" />
</head>

<div class="las-formBox-title">
    <p>Đăng nhập</p>
</div>
<div class="las-form">
    <div class="las-form-error" id="las-form-error" role="alert" style="display: none;">
        <div class="las-form-error-icon"><svg viewBox="0 0 16 16">
                <path fill="none" stroke="#FF424F" d="M8 15A7 7 0 108 1a7 7 0 000 14z" clip-rule="evenodd"></path>
                <rect stroke="none" width="7" height="1.5" x="6.061" y="5" fill="#FF424F" rx=".75"
                    transform="rotate(45 6.06 5)"></rect>
                <rect stroke="none" width="7" height="1.5" fill="#FF424F" rx=".75"
                    transform="scale(-1 1) rotate(45 -11.01 -9.51)"></rect>
            </svg></div>
        <div>
            <div id="las-form-error-text"></div>
        </div>
    </div>
    <form id="form">
        <div class="las-form-input-field">
            <div class="las-form-input"><input type="text" placeholder="Email/Số điện thoại" autocomplete="on"
                    id="username" name="username"></div>
            <span class="las-form-input-error" id="error-username"></span>
        </div>
        <div class="las-form-input-field">
            <div class="las-form-input">
                <input type="password" placeholder="Mật khẩu" autocomplete="current-password" id="password"
                    name="password">
                <div class="las-form-visible"><svg fill="none" viewBox="0 0 20 10" class="_340FWs">
                        <path stroke="none" fill="#000" fill-opacity=".54"
                            d="M19.834 1.15a.768.768 0 00-.142-1c-.322-.25-.75-.178-1 .143-.035.036-3.997 4.712-8.709 4.712-4.569 0-8.71-4.712-8.745-4.748a.724.724 0 00-1-.071.724.724 0 00-.07 1c.07.106.927 1.07 2.283 2.141L.631 5.219a.69.69 0 00.036 1c.071.142.25.213.428.213a.705.705 0 00.5-.214l1.963-2.034A13.91 13.91 0 006.806 5.86l-.75 2.535a.714.714 0 00.5.892h.214a.688.688 0 00.679-.535l.75-2.535a9.758 9.758 0 001.784.179c.607 0 1.213-.072 1.785-.179l.75 2.499c.07.321.392.535.677.535.072 0 .143 0 .179-.035a.714.714 0 00.5-.893l-.75-2.498a13.914 13.914 0 003.248-1.678L18.3 6.147a.705.705 0 00.5.214.705.705 0 00.499-.214.723.723 0 00.036-1l-1.82-1.891c1.463-1.071 2.32-2.106 2.32-2.106z">
                        </path>
                    </svg></div>
            </div>
            <span class="las-form-input-error" id="error-password"></span>
        </div><button class="las-form-btn">Đăng nhập</button>
    </form>
    <div class="las-form-forget"><a href="/buyer/reset">Quên mật khẩu</a></div>

</div>
<div class="las-form-register">
    <p>Bạn mới biết đến Fake Shopee? <a asp-controller="LoginAndSignup" asp-action="Register">Đăng ký</a></p>
</div>

<script>
    const form = document.getElementById("form");
    const username = document.getElementById("username");
    const password = document.getElementById("password");
    const errorForm = document.getElementById("las-form-error");
    const errorText = document.getElementById("las-form-error-text");
    const errorUsername = document.getElementById("error-username");
    const errorPassword = document.getElementById("error-password");

    function setCookie(cname, cvalue, exdays) {
        const d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        let expires = "expires="+ d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        errorForm.style.display = "none";
        if(!username.value){
            errorUsername.innerHTML = "Vui lòng nhập Số điện thoại/Email";
            return;
        }else{
            errorUsername.innerHTML = "";
        }
        if(!password.value){
            errorPassword.innerHTML = "Vui lòng nhập Mật khẩu";
            return;
        }else{
            errorPassword.innerHTML = "";
        }
        const response = await fetch("/LoginAndSignup/Login", {
            method: "POST",
            headers: {
                //"Content-Type": "application/json",
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                username: username.value.toString(),
                password: password.value.toString()
            })
        })
        const text = await response.text();
        if(response.status===200){
            setCookie("token", text, 3);
            window.location.replace("/");
        }else{
            errorForm.style.display = "flex";
            errorText.innerHTML = text;
        }
    })
</script>